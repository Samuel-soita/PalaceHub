generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                String          @id @default(uuid())
  email             String          @unique
  password          String
  name              String
  role              String          @default("MEMBER")
  departmentId      String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  announcements     Announcement[]
  assignedFollowUps Meeting[]       @relation("MeetingFollowUp")
  meetingsOrganized Meeting[]       @relation("MeetingOrganizer")
  prayerRequests    PrayerRequest[]
  department        Department?     @relation("DeptLeader", fields: [departmentId], references: [id])
}

model Department {
  id            String         @id @default(uuid())
  name          String         @unique
  description   String?
  leaderId      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  announcements Announcement[]
  assets        Asset[]
  budgets       Budget[]
  contributors  Contributor[]
  meetings      Meeting[]
  strategies    Strategy[]
  events        Event[]
  leaders       User[]         @relation("DeptLeader")
  volunteers    Volunteer[]
}

model Event {
  id               String      @id @default(uuid())
  title            String
  date             DateTime
  time             String
  location         String
  departmentId     String
  department       Department  @relation(fields: [departmentId], references: [id])
  budgetNeeded     Float       @default(0)
  volunteersNeeded Int         @default(0)
  status           String      @default("PLANNED") // PLANNED, ACTIVE, COMPLETED, CANCELLED
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

model Meeting {
  id               String     @id @default(uuid())
  title            String
  departmentId     String
  date             DateTime
  time             String
  venue            String
  meetingType      String
  agenda           String
  organizerId      String
  followUpPersonId String?
  followUpDeadline DateTime?
  followUpStatus   String     @default("PENDING")
  meetingStatus    String     @default("SCHEDULED")
  minutes          String?
  attendance       String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  followUpPerson   User?      @relation("MeetingFollowUp", fields: [followUpPersonId], references: [id])
  organizer        User       @relation("MeetingOrganizer", fields: [organizerId], references: [id])
  department       Department @relation(fields: [departmentId], references: [id])
}

model Budget {
  id            String        @id @default(uuid())
  title         String
  targetAmount  Float
  amountRaised  Float         @default(0)
  linkedEventId String?
  deadline      DateTime
  status        String        @default("OPEN")
  departmentId  String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  department    Department    @relation(fields: [departmentId], references: [id])
  contributors  Contributor[]
}

model Contributor {
  id            String     @id @default(uuid())
  name          String
  amount        Float
  paymentMethod String
  date          DateTime   @default(now())
  budgetId      String
  departmentId  String
  anonymousFlag Boolean    @default(false)
  notes         String?
  department    Department @relation(fields: [departmentId], references: [id])
  budget        Budget     @relation(fields: [budgetId], references: [id])
}

model Announcement {
  id           String      @id @default(uuid())
  title        String
  content      String
  priority     String      @default("NORMAL")
  expiry       DateTime?
  authorId     String
  departmentId String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  department   Department? @relation(fields: [departmentId], references: [id])
  author       User        @relation(fields: [authorId], references: [id])
}

model PrayerRequest {
  id           String   @id @default(uuid())
  requesterId  String
  content      String
  privacyLevel String   @default("PRIVATE")
  status       String   @default("PENDING")
  assignedTeam String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  requester    User     @relation(fields: [requesterId], references: [id])
}

model Volunteer {
  id           String     @id @default(uuid())
  name         String
  email        String?
  skills       String?
  availability String?
  departmentId String
  status       String     @default("ACTIVE")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  department   Department @relation(fields: [departmentId], references: [id])
}

model Asset {
  id                  String     @id @default(uuid())
  name                String
  condition           String
  assignedTo          String?
  maintenanceSchedule String?
  departmentId        String
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  department          Department @relation(fields: [departmentId], references: [id])
}

model Strategy {
  id             String     @id @default(uuid())
  title          String
  actionItems    String
  assignedPerson String?
  deadline       DateTime?
  status         String     @default("PENDING")
  departmentId   String
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  department     Department @relation(fields: [departmentId], references: [id])
}
